# Samba Configuration for Lame Machine (3.0.20 Usermap Script Vulnerable)
# This configuration simulates the classic CVE-2007-2447 vulnerability

[global]
    # Basic server information
    workgroup = WORKGROUP
    server string = Lame server (Samba %v)
    netbios name = LAME
    
    # Security settings (vulnerable like 3.0.20)
    security = share
    map to guest = bad user
    guest account = nobody
    
    # Enable the vulnerable username map script feature
    # This is the core vulnerability CVE-2007-2447
    username map script = /opt/lame/vulnerable-smb-usermap.py
    
    # SMB protocol versions (old vulnerable versions)
    server min protocol = NT1
    client min protocol = NT1
    
    # Logging
    log file = /var/log/samba/log.%m
    max log size = 1000
    log level = 2
    
    # Interfaces
    interfaces = lo eth0
    bind interfaces only = yes
    
    # Authentication settings (vulnerable)
    encrypt passwords = yes
    passdb backend = tdbsam
    obey pam restrictions = no
    
    # File settings
    unix password sync = yes
    passwd program = /usr/bin/passwd %u
    passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
    pam password change = yes
    
    # Disable some modern security features
    client signing = disabled
    server signing = disabled

# Temporary share (classic OSCP enumeration target)
[tmp]
    comment = oh noes!
    path = /tmp
    guest ok = yes
    read only = no
    browsable = yes
    public = yes
    writable = yes

# Opt share (another classic)
[opt]
    comment = Opt directory
    path = /opt
    guest ok = yes
    read only = yes
    browsable = yes

# Anonymous FTP-like share
[anonymous]
    comment = Anonymous Share
    path = /home/ftp
    guest ok = yes
    read only = no
    browsable = yes
    public = yes

# Home directories
[homes]
    comment = Home Directories
    browseable = no
    read only = no
    create mask = 0700
    directory mask = 0700
    valid users = %S