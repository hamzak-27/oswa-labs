# OSWA Labs OpenVPN Server Configuration

# Server mode and protocol
mode server
tls-server
proto udp
port 1194

# Virtual network interface
dev tun
dev-type tun

# SSL/TLS root certificate (ca), certificate (cert), and private key (key)
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/issued/server.crt
key /etc/openvpn/pki/private/server.key
dh /etc/openvpn/pki/dh.pem
tls-auth /etc/openvpn/pki/ta.key 0

# Network topology
topology subnet

# VPN subnet - clients will get IPs from this range
server 10.8.0.0 255.255.255.0

# Maintain a record of client ‚ü∑ virtual IP address associations
ifconfig-pool-persist ipp.txt

# Configure server mode for ethernet bridging
# Push routes to client for lab networks
push "route 172.20.1.0 255.255.255.0"  # XSS Lab Network
push "route 172.20.2.0 255.255.255.0"  # JWT Lab Network  
push "route 172.20.3.0 255.255.255.0"  # SQL Lab Network
push "route 172.21.0.0 255.255.0.0"    # Additional Lab Networks

# Push DNS servers
push "dhcp-option DNS 8.8.8.8"
push "dhcp-option DNS 8.8.4.4"

# Client can connect with same certificate/key multiple times
duplicate-cn

# Enable compression on the VPN link
comp-lzo

# The keepalive directive causes ping-like messages to be sent back and forth
keepalive 10 120

# Select a cryptographic cipher
cipher AES-256-CBC

# Enable TLS and assume server role during TLS handshake
tls-server

# Diffie hellman parameters
dh /etc/openvpn/pki/dh.pem

# The server will take 10.8.0.1 for itself
# The rest will be made available to clients

# Maintain client IP addresses between restarts
persist-key
persist-tun

# Output a short status file showing current connections
status /var/log/openvpn/openvpn-status.log

# Log levels:
# 0 = silent except fatal errors
# 4 = reasonable for general usage
# 5 and 6 can help to debug connection problems
# 9 = extremely verbose
verb 4

# Silence repeating messages
mute 20

# Enable management interface for API control
management 0.0.0.0 7505

# Client configuration directory
client-config-dir /etc/openvpn/ccd

# Allow clients to see each other
client-to-client

# Maximum number of clients
max-clients 50

# User/group to run OpenVPN as
user vpn
group nogroup

# Notify client of restart
explicit-exit-notify 1